<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Crown Commercial Service - Full Page</title>
    <style>
        :root {
            --ccs-blue: #005ea5;
            --ccs-light-blue: #b1d1e3;
            --ccs-text: #0b0c0c;
            --ccs-grey: #f3f2f1;
            --ccs-glossary: #eef2d8;
        }

        body {
            font-family: Arial, sans-serif;
            margin: 0;
            color: var(--ccs-text);
            line-height: 1.5;
        }

        /* Top Bar & Header */
        .top-nav { background: #8fb3ff; padding: 10px 5%; font-size: 14px; border-bottom: 1px solid #bfc1c3; display: flex; justify-content: space-between; }
        header { padding: 20px 5%; display: flex; align-items: center; justify-content: space-between; }
        .logo { font-weight: bold; font-size: 20px; display: flex; align-items: center; }
        .logo img {
    height: 85px;  /* Adjust this value (e.g., 20px, 30px) to your liking */
    width: auto;   /* Maintains aspect ratio */
    margin-right: 8px;
}
        nav ul { list-style: none; display: flex; gap: 20px; margin: 0; padding: 0; }
        nav ul li a { text-decoration: none; color: var(--ccs-text); font-weight: bold; font-size: 14px; }

        /* Hero Section */
        .hero { background-color:#8fb3ff; padding: 60px 5%; display: flex; justify-content: space-between; align-items: center; }
        .hero-content { max-width: 500px; }
        .search-boxes { display: flex; gap: 20px; }
        .search-card { background: rgba(255,255,255,0.4); padding: 20px; width: 220px; }
        .search-card input { width: 90%; padding: 8px; border: 1px solid #000; margin-top: 10px; }

        /* Info & News Sections */
        .info-section { display: grid; grid-template-columns: repeat(3, 1fr); gap: 20px; padding: 50px 5%; }
        .info-card { border-top: 5px solid #a1b12e; padding: 20px; background: #fff; border: 1px solid #bbc946; border-top-width: 5px; }

        .news-section { padding: 50px 5%; }
        .news-grid { display: grid; grid-template-columns: 1fr 1fr 1.5fr; gap: 25px; }
        .news-item img { width: 100%; height: auto; }
        .blue-cta-box { background: #8fb6e9; padding: 30px; border-radius: 4px; }
        .btn-download { background: #b5c327; padding: 10px 20px; border: none; font-weight: bold; cursor: pointer; margin-top: 20px; }

        /* NEW: Glossary Section */
        .glossary-banner {
            background-color: var(--ccs-glossary);
            padding: 40px 5%;
            display: flex;
            align-items: flex-start;
            gap: 20px;
        }
        .glossary-icon { background: #fff; padding: 10px; border-radius: 50%; border: 1px solid #d53880; }

        /* NEW: Footer Section */
        footer {
            padding: 50px 5%;
            background: #fff;
            border-top: 1px solid #bfc1c3;
            display: grid;
            grid-template-columns: repeat(4, 1fr);
            gap: 30px;
        }
        .footer-col h4 { font-size: 16px; margin-bottom: 20px; }
        .footer-col ul { list-style: none; padding: 0; }
        .footer-col ul li { margin-bottom: 12px; }
        .footer-col ul li a { text-decoration: none; color: var(--ccs-text); font-size: 13px; }
        .footer-col ul li a:hover { text-decoration: underline; color: var(--ccs-blue); }

        .back-to-top { text-align: right; padding: 10px 5%; font-size: 12px; }
        #chat-window {
            display: none; position: fixed; bottom: 80px; right: 20px;
            width: 380px; height: 500px; background: white;
            border: 1px solid #ccc; border-radius: 8px;
            flex-direction: column; z-index: 1000; box-shadow: 0 5px 15px rgba(0,0,0,0.2);
        }
        .chat-header { background: var(--ccs-blue); color: white; padding: 15px; border-radius: 8px 8px 0 0; font-weight: bold; }
        #chat-messages { flex: 1; padding: 15px; overflow-y: auto; display: flex; flex-direction: column; gap: 12px; font-size: 14px; }
        .source-tag { display: inline-block; background: #eef2d8; border: 1px solid #a1b12e; padding: 2px 6px; border-radius: 3px; font-size: 11px; margin: 2px; }

        .download-btn {
    background: #f3f2f1;
    border: 1px solid #bfc1c3;
    color: #005ea5;
    padding: 6px 12px;
    font-size: 12px;
    font-weight: bold;
    text-align: left;
    cursor: pointer;
    border-radius: 4px;
    transition: background 0.2s;

    display: flex;
    align-items: flex-start; /* Aligns the icon to the top of the text */
    width: 100%;             /* Ensures it stays within the chat bubble */
    box-sizing: border-box;  /* Prevents padding from adding to width */
    white-space: normal;     /* Allows text to wrap to the next line */
    word-break: break-all;   /* Prevents long strings without spaces from breaking the layout */
    line-height: 1.4;
}

    .download-btn:hover {
        background: #005ea5;
        color: white;
    }
        .msg, .msg-bot, .msg-user {
    word-wrap: break-word;       /* Older browser support */
    overflow-wrap: break-word;   /* Prevents text from pushing past the edge */
    word-break: break-word;      /* Forces long strings like URLs to wrap */
    max-width: 90%;              /* Ensures bubble doesn't hit the very edge */
}
    </style>
</head>
<body>

    <div class="top-nav">
        <div><span style="background:#b9d2e8; color:#090b10; padding:2px 5px;">beta</span> Help us make this service better. <u>Give feedback</u></div>
        <div>Public Procurement Gateway: <a href="#">Create account</a> or <a href="#">Sign in</a></div>
    </div>

    <header style="background-color: #8fb3ff; padding: 10px 20px;">
        <div class="logo">
            <img src="{{ url_for('static', filename='logo2.png') }}" alt="Logo">
        </div>
        <nav >
            <ul>
                <li>Products and suppliers â–¾</li>
                <li>For buyers â–¾</li>
                <li>For suppliers â–¾</li>
                <li>About â–¾</li>
                <li>News â–¾</li>
                <li>Help and support</li>
                <li>Digital platforms â–¾</li>
            </ul>
        </nav>
        <button id="chat-toggle" style="position: fixed; bottom: 20px; right: 20px; background: #005ea5; color: white; border: none; padding: 15px; border-radius: 50%; cursor: pointer; z-index: 1000;">ðŸ’¬</button>
        <div id="chat-window">
        <div class="chat-header" style="background: #6a99ff">CCS Assistant</div>
        <div id="chat-messages">         <div style="background: #f3f2f1; padding: 10px; border-radius: 8px; align-self: flex-start;">
                Hello! I am your web guide. How can I help you today?
            </div> </div>
        <div style="padding: 10px; border-top: 1px solid #eee; display: flex; gap: 5px;">
            <input type="text" id="chat-input" placeholder="Ask about CCS frameworks..." style="flex: 1; padding: 8px;">
            <button onclick="sendQuery()" style="background: #00703c; color: white; border: none; padding: 8px 12px; cursor: pointer;">Send</button>
        </div>
    </div>
    </header>

    <section class="hero">
        <div class="hero-content" >
            <h1>Supporting better public procurement</h1>
            <p><a href="#">Find out how we help the UK public sector achieve value for the nation in our digital brochure.</a></p>
        </div>
        <div class="search-boxes">
            <div class="search-card"><strong>Search agreements</strong><input type="text"></div>
            <div class="search-card"><strong>Search suppliers</strong><input type="text"></div>
        </div>
    </section>

    <section class="info-section">
        <div class="info-card">
            <h3>How to buy</h3>
            <p>With over 100 commercial agreements, we can help you get better value from products and services. Learn about our buying routes and what you can buy.
            </p>
            <a href="#">Learn how to buy.</a>
        </div>
        <div class="info-card">
            <h3>How to supply</h3>
            <p>The UK public sector spends billions every year on products and services. Learn how your organisation can benefit from becoming a supplier.</p>
            <a href="#">Learn how to supply.</a>
        </div>
        <div class="info-card">
            <h3>Transforming Public Procurement</h3>
            <p>The Transforming Public Procurement (TPP) programme will change how public procurement in the United Kingdom is regulated.</p>
            <a href="#">Learn about the TPP programme.</a>
        </div>
    </section>

    <section class="news-section">
        <h2>Latest news</h2>
        <div class="news-grid">
            <div class="news-item">
                <img src="{{ url_for('static', filename='news.png') }}" alt="News">
                <p><strong>Changes to our agreements in December</strong></p>
                <small>12th January 2026</small>
            </div>
            <div class="news-item">
                <img src="{{ url_for('static', filename='news2.png') }}" alt="Supplier">
                <p><strong>How to successfully subcontract</strong></p>
                <small>7th January 2026</small>
            </div>
            <div class="blue-cta-box" style="background-color: #8fb3ff; padding: 10px 20px;">
                <h2>Digital brochure 2025-2026</h2>
                <p>Turning your buying decisions into lasting impact</p>
                <button class="btn-download">Download our digital brochure</button>
            </div>
        </div>
        <p><a href="#">Browse all news articles</a></p>
    </section>

    <div class="glossary-banner">
        <div class="glossary-icon">ðŸ“–</div>
        <div>
            <h3>Glossary</h3>
            <p>We understand procurement can be confusing. Use our glossary to learn common terms.</p>
            <a href="#">Read the glossary</a>
        </div>
    </div>

    <div class="back-to-top">Back to top â†‘</div>

    <footer>
        <div class="footer-col">
            <h4>Products and support</h4>
            <ul>
                <li><a href="#">Search agreements</a></li>
                <li><a href="#">Search upcoming agreements</a></li>
                <li><a href="#">Search suppliers</a></li>
                <li><a href="#">Sectors</a></li>
            </ul>
        </div>
        <div class="footer-col">
            <h4>For buyers and suppliers</h4>
            <ul>
                <li><a href="#">How to buy</a></li>
                <li><a href="#">Procurement Essentials articles</a></li>
                <li><a href="#">Subscribe to newsletter</a></li>
                <li><a href="#">How to supply</a></li>
            </ul>
        </div>
        <div class="footer-col">
            <h4>Corporate information</h4>
            <ul>
                <li><a href="#">GOV.UK</a></li>
                <li><a href="#">About CCS</a></li>
                <li><a href="#">Press Office</a></li>
                <li><a href="#">Public sector equality</a></li>
            </ul>
        </div>
        <div class="footer-col">
            <h4>Digital platforms</h4>
            <ul>
                <li><a href="#">Contracts Finder</a></li>
                <li><a href="#">Find a Tender</a></li>
                <li><a href="#">Register for eMarketplace</a></li>
                <li><a href="#">Sign in to Digital Marketplace</a></li>
            </ul>
        </div>
    </footer>
    <script>
const chatWindow = document.getElementById('chat-window');
        const chatMessages = document.getElementById('chat-messages');
        const chatInput = document.getElementById('chat-input');

        // Toggle visibility
        document.getElementById('chat-toggle').onclick = () => {
            // If it's currently flex, hide it. Otherwise, show it.
            if (chatWindow.style.display === 'flex') {
                chatWindow.style.display = 'none';
            } else {
                chatWindow.style.display = 'flex';
            }
        };

        async function downloadSource(fileName) {
            try {
                const response = await fetch(`http://127.0.0.1:8000/get_download_url/${fileName}`);
                if (!response.ok) throw new Error("Backend failed to generate URL");
                const data = await response.json();

                const hiddenLink = document.createElement('a');
                hiddenLink.href = data.download_url;
                hiddenLink.setAttribute('download', fileName);

                document.body.appendChild(hiddenLink);
                hiddenLink.click();
                document.body.removeChild(hiddenLink);
            } catch (error) {
                console.error("Download Error:", error);
                alert("Unable to download file. Ensure your FastAPI server is running on port 8000.");
            }
        }

        async function sendQuery() {
            const query = chatInput.value.trim();
            if (!query) return;

            // 1. Add User Message to UI
            appendMessage(query, 'user');
            chatInput.value = '';

            try {
                // 2. Fetch from your FastAPI App
                const response = await fetch(' http://127.0.0.1:8000/results', {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({
                        user_id: "{{ user_id }}", // using session id
                        query: query
                    })
                });

                const data = await response.json();

                // 3. Process AI_response and source_content
                let responseHTML = `<div class="msg-content">${data.AI_response}</div>`;

                if (data.source_content && data.source_content.length > 0) {
                    responseHTML += `
                            <div style="border-top: 1px solid #ddd; padding-top: 10px; margin-top: 10px;">
                                <p style="font-size: 11px; font-weight: bold; color: #666; margin-bottom: 5px;">SOURCES:</p>
                                <div style="display: flex; flex-direction: column; gap: 5px;">
                                    ${data.source_content.map(source => `
                                        <button onclick="downloadSource('${source}')" class="download-btn">
                                            ðŸ“¥ ${source}
                                        </button>
                                    `).join('')}
                                </div>
                            </div>
                        `;
                }

                appendMessage(responseHTML, 'bot');

            } catch (error) {
                appendMessage("Error connecting to AI service.", 'bot');
            }
        }

        function appendMessage(content, sender) {
            const msg = document.createElement('div');
            msg.style.padding = "10px";
            msg.style.borderRadius = "8px";
            msg.style.maxWidth = "85%";

            msg.style.overflowWrap = "break-word";
            msg.style.wordBreak = "break-word";

            if (sender === 'user') {
                msg.style.background = "#005ea5";
                msg.style.color = "white";
                msg.style.alignSelf = "flex-end";
                msg.textContent = content;
            } else {
                msg.style.background = "#f3f2f1";
                msg.style.alignSelf = "flex-start";
                msg.innerHTML = content;
            }
            chatMessages.appendChild(msg);
            chatMessages.scrollTop = chatMessages.scrollHeight;
        }
    </script>
</body>
</html>